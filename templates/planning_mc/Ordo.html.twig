{% extends 'base.html.twig' %}


{% block title %}Ordonnancement{% endblock %}

{% block body %}
<style>
.card {
        border: 0rem;
        border-radius: 0rem;
    }
    
    .card-header {
        background-color: #37474F;
        border-radius: 0 !important;
        color:	white;
        margin-bottom: 0;
        padding:	1rem;
    }
    
    .card-block {
        border: 1px solid #cccccc;
    }
    
    .shadow {
        box-shadow: 0 6px 10px 0 rgba(0, 0, 0, 0.14),
                                0 1px 18px 0 rgba(0, 0, 0, 0.12),
                                0 3px 5px -1px rgba(0, 0, 0, 0.2);
    }
 #chart-Repart-Charge,#chart-Charge-Tot{
        height: 300px;
        width: 100%;
    }
.multicharts{
    display:    flex;
}	
.table-responsive{
	height: 300px;
	overflow: auto;
}

</style>
	<h1>Charge des différents postes ! ✅</h1>

<div class="container-fluid">
    <h2 id="header">
        <strong>Charge Découpe</strong>
        <small class="text-muted">Jan 2020 - Dec 2020</small>
    </h2>
    <h2 id="header">
        <strong>Charge Moyen Chaud</strong>
        <small class="text-muted">Jan 2020 - Dec 2020</small>
    </h2>
    <div class="row m-b-1">
        <div class="col-xl-6">
            <div class="card shadow">
            <h4 class="card-header">Charge SAP par programme de S{{SemUn|raw}} à S{{DerSem|raw}}</h4>
                <div class="card-block">
                    <div id="chart-Repart-Charge"></div>
                </div>
            </div>
        </div>
		<div class="col-xl-6">
            <div class="card shadow">
            <h4 class="card-header">Retard Charge SAP -1 mois</h4>
                <div class="card-block">
                    <div id="chart-Charge-Retard"></div>
                </div>
            </div>
        </div>
	</div>    
	<hr></hr>
    <div class="row m-b-1">
		<div class="col-xl-12">
            <div class="card shadow filterable">
				<div class="card-header">
					<h4>Liste OF charge SAP</h4>
					<button class="btn btn-primary btn-filter"><span class="glyphicon glyphicon-th-list"></span>Filter</button>
				</div>
				<div class="card-block">
					<div class="table-responsive">
						<table class="table table-sm table-hover">
							<thead class="thead-dark">
								<tr class="filters">
									<th><input type="text" class="form-control" placeholder="#"></th>
									<th><input type="text" class="form-control" placeholder="OF"></th>
									<th><input type="text" class="form-control" placeholder="PosteW"></th>
									<th><input type="text" class="form-control" placeholder="Ref"></th>
									<th><input type="text" class="form-control" placeholder="Désignation"></th>
									<th><input type="text" class="form-control" placeholder="Prog"></th>
									<th><input type="text" class="form-control" placeholder="Conf"></th>
									<th><input type="text" class="form-control" placeholder="Date Debut"></th>
									<th><input type="text" class="form-control" placeholder="Date Fin"></th>
									<th><input type="text" class="form-control" placeholder="Date Création"></th>
									<th><input type="text" class="form-control" placeholder="Statut"></th>
								</tr>
							</thead>
							<tbody id="myTable">
								{% for chargeT in ChargeTot %}
									<tr>
										<td>{{chargeT.id}}</td>
										<td>{{chargeT.OrdreFab}}</td>
										<td>{{chargeT.PosteW}}</td>
										<td>{{chargeT.ReferencePcs}}</td>
										<td>{{chargeT.DesignationPcs}}</td>
										<td>{{chargeT.NumProg}}</td>
										<td>{{chargeT.Conf}}</td>
										<td>{{chargeT.DateDeb|date('Y-m-d')}}</td>
										<td>{{chargeT.DateFin|date('Y-m-d')}}</td>
										<td>{{chargeT.DateCreation|date('Y-m-d')}}</td>
										<td>{{chargeT.Statut}}</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
            </div>
        </div>
	</div>
	<hr></hr>
	<div class="row m-b-1">
        <div class="col-xl-12">
            <div class="card shadow">
            <h4 class="card-header">Charge Totale SAP par programme : {{ChargeTot|length}} pcs</h4>
                <div class="card-block">
                    <div id="chart-Repart-ChargeTot"></div>
                </div>
            </div>
        </div>
	</div>
</div>
{% endblock %}
{% block javascripts %}
<script src="{{ asset('build/jquery.min.js') }}"></script>
<script src="{{ asset('build/canvasjs.min.js') }}"></script>
<script src="{{ asset('build/bootstrap.min.js') }}"></script>
<script src="{{ asset('build/tether.min.js') }}"></script>
<script type="text/javascript"> 
$(document).ready(function(){
    $('.filterable .btn-filter').click(function(){
        var $panel = $(this).parents('.filterable'),
        $filters = $panel.find('.filters input'),
        $tbody = $panel.find('.table tbody');
        if ($filters.prop('disabled') == true) {
            $filters.prop('disabled', false);
            $filters.first().focus();
        } else {
            $filters.val('').prop('disabled', true);
            $tbody.find('.no-result').remove();
            $tbody.find('tr').show();
        }
    });

    $('.filterable .filters input').keyup(function(e){
        /* Ignore tab key */
        var code = e.keyCode || e.which;
        if (code == '9') return;
        /* Useful DOM data and selectors */
        var $input = $(this),
        inputContent = $input.val().toLowerCase(),
        $panel = $input.parents('.filterable'),
        column = $panel.find('.filters th').index($input.parents('th')),
        $table = $panel.find('.table'),
        $rows = $table.find('tbody tr');
        /* Dirtiest filter function ever ;) */
        var $filteredRows = $rows.filter(function(){
            var value = $(this).find('td').eq(column).text().toLowerCase();
            return value.indexOf(inputContent) === -1;
        });
        /* Clean previous no-result if exist */
        $table.find('tbody .no-result').remove();
        /* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
        $rows.show();
        $filteredRows.hide();
        /* Prepend no-result row if all rows are filtered */
        if ($filteredRows.length === $rows.length) {
            $table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="'+ $table.find('.filters th').length +'">No result found</td></tr>'));
        }
    });
});

        $(function () {
			//Graph de répartition des cycles par semaine de la charge SAP sur le mois
            var Chart = new CanvasJS.Chart("chart-Repart-Charge", {
                animationEnabled: true,
                exportEnabled: true,
                backgroundColor: "transparent",
                theme: "light2",
                axisX: {
                    labelFontSize: 14,
                    valueFormatString: "D MMM Y",
                    interval: 1,
                    intervalType: "week"
                },
                axisY: {
                    labelFontSize: 14,
                    prefix: ""
				},
				legend: {
					maxHeight: 50,
					fontSize: 10,
				},
                toolTip: {
                    shared: true
                },
                data: {{RepartPcs|raw}}
            });

			Chart.render();

			//Graph de la charge retard de 1 mois de SAP
			var Chart = new CanvasJS.Chart("chart-Charge-Retard", {
                animationEnabled: true,
                exportEnabled: true,
                backgroundColor: "transparent",
                theme: "light2",
                axisX: {
                    labelFontSize: 14,
                    valueFormatString: "D MMM Y",
                    interval: 1,
                    intervalType: "week"
                },
                axisY: {
                    labelFontSize: 14,
                    prefix: ""
				},
				legend: {
					maxHeight: 50,
					fontSize: 10,
				},
                toolTip: {
                    shared: true
                },
                data: {{RepartRetard|raw}}
            });

			Chart.render();
 
			//Graph de la charge totale de SAP
			var Chart = new CanvasJS.Chart("chart-Repart-ChargeTot", {
                animationEnabled: true,
                exportEnabled: true,
                backgroundColor: "transparent",
                theme: "light2",
                axisX: {
                    labelFontSize: 14,
                    valueFormatString: "D MMM Y",
                    interval: 1,
					intervalType: "month",
					scaleBreaks: {
						type: "straight",
						fillOpacity: 1,
						autoCalculate: true,
						maxNumberOfAutoBreaks: 6
					},
				},
				dataPointMaxWidth: 5,
                axisY: {
                    labelFontSize: 14,
                    prefix: ""
				},
				legend: {
					maxHeight: 50,
					fontSize: 10,
				},
                toolTip: {
                    shared: true
                },
                data: {{RepartT|raw}}
            });

			Chart.render();
		});
</script>
{% endblock %}