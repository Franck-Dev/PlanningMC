{% extends 'base.html.twig' %}

{% block title %}APAMC {{ controller_name }}!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    body {
        background-color: #fafafa;
        font-size: 16px;
        line-height: 1.5;
    }
    
    h1,h2,h3,h4,h5,h6 {
        font-weight: 400;	
    }
    
    #header {
        border-bottom: 5px solid #37474F;
        color: #37474F;
        margin-bottom: 1.5rem;
        padding: 1rem 0;
    }
    
    #revenue-tag {
        font-weight: inherit !important;
        border-radius: 0px !important;
    }
    
    .card {
        border: 0rem;
        border-radius: 0rem;
    }
    
    .card-header {
        background-color: #37474F;
        border-radius: 0 !important;
        color:	white;
        margin-bottom: 0;
        padding:	1rem;
    }
    
    .card-block {
        border: 1px solid #cccccc;	
    }
    
    .shadow {
        box-shadow: 0 6px 10px 0 rgba(0, 0, 0, 0.14),
                                0 1px 18px 0 rgba(0, 0, 0, 0.12),
                                0 3px 5px -1px rgba(0, 0, 0, 0.2);
    }
    
    #revenue-column-chart, #products-revenue-pie-chart, #orders-spline-chart,#sales-doughnut-chart-us,#users-countries-bar-chart,#chartContainer {
        height: 300px;
        width: 100%;
    }			
</style>

<div class="example-wrapper">

<h1> Bienvenue sur l'application de l'UAP PE de l'Usine de Tarbes Composite ✅</h1>

</div>
<div class="container">
        <h2 id="header">
            <strong>Indicateurs Polymérisation</strong>
            <small class="text-muted">Jan {{Jour| date('Y')}} - Dec {{Jour| date('Y')}}</small>
        </h2>
        
        <div class="row m-b-1">
            <div class="col-xl-4">
                <div class="card shadow">
                    <h4 class="card-header">Quantité Produite au {{Jour| date('d/m/Y')}} : {{TotPcs|raw}} <span class="tag tag-success" id="revenue-tag">pcs</span></h4>
                    <div class="card-block">
                        <div id="revenue-column-chart"></div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3">
                    <div class="card shadow">
                        <h4 class="card-header">TRS du : {{Jour| date('d/m/Y')}} <span class="tag tag-success" id="revenue-tag">(Capa: {{CapaMach|raw}}H)</span></h4>
                        <div class="card-block">
                            <div id="sales-doughnut-chart-us"></div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-5">
                    <div class="card shadow">
                        <h4 class="card-header">Charge de la semaine {{Semaine|raw}} par Moyens (Totale : {{CharTot|raw}} H)<span class="tag tag-success" id="revenue-tag"> {{HProdSem|raw}}H de réalisées</span></h4>
                        <div class="card-block">
                            <div id="users-countries-bar-chart"></div>
                        </div>
                    </div>
                </div>
        </div> <!-- row -->
        <hr></hr>
        <div class="row m-b-1">
            <div class="col-xl-6">
                <div class="card shadow">
                    <h4 class="card-header">Prod du {{Jour| date('d/m/Y')}} pour {{NbPolymJ|raw}} Progs lancés</h4>
                    <div class="card-block">
                        <div id="products-revenue-pie-chart"></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card shadow">
                    <h4 class="card-header">OTD Moulage</h4>
                    <div class="card-block">
                        <div id="orders-spline-chart"></div>
                    </div>
                </div>
            </div>
        </div> <!-- row -->
        <hr></hr>
        <div class="row">
            <div class="col-xl-8">
                <div class="card shadow">
                    <h4 class="card-header">Production par moyen de la semaine {{Semaine|raw}} :  {{PProdSem|raw}} pcs faites / Y à réaliser</h4>
                    <div class="card-block">
                        <div id="chartContainer"></div>
                    </div>
                </div>
            </div>
            <div class="col-xl-4">
                <div class="card shadow">
                    <h4 class="card-header">Productivité de la semaine {{Semaine|raw}} : {{RapportPH|raw}} pcs/H</h4>
                    <div class="card-block">
                        <div id="Rapport-Heures-pieces"></div>
                    </div>
                </div>
            </div>
        </div><!-- row -->
        <hr></hr>
    </div> <!-- container -->
{% endblock %}
{% block javascripts %}
<script src="{{ asset('build/jquery.min.js') }}"></script>
<script src="{{ asset('build/canvasjs.min.js') }}"></script>
<script src="{{ asset('build/bootstrap.min.js') }}"></script>
<script src="{{ asset('build/tether.min.js') }}"></script>
<script type="text/javascript"> 
        $(function () {
            //var totalRevenue = 15341110;
            //var totalUsers = 7687036;
            // CanvasJS column chart to show revenue from Jan 2015 - Dec 2015
            var revenueColumnChart = new CanvasJS.Chart("revenue-column-chart", {
                animationEnabled: true,
                exportEnabled: true,
                backgroundColor: "transparent",
                theme: "theme2",
                axisX: {
                    labelFontSize: 14,
                    valueFormatString: "MM YYYY"
                },
                axisY: {
                    labelFontSize: 14,
                    prefix: ""
                },
                toolTip: {
                    borderThickness: 0,
                    cornerRadius: 0
                },
                data: [
                    {
                        type: "column",
                        yValueFormatString: "####",
                        xValueType: "dateTime",
                        dataPoints: {{RepartPcs|raw}}
                    }
                ]
            });

            revenueColumnChart.render();

                // CanvasJS doughnut chart to show annual sales percentage from United States(US)
                var salesDoughnutChartUS = new CanvasJS.Chart("sales-doughnut-chart-us", { 
                    animationEnabled: true,
                    exportEnabled: true,
                    theme: "theme2",
                    title: {
                            fontColor: "#848484",
                            fontSize: 70,
                            horizontalAlign: "center",
                            text: {{PercentTRS|raw}}+"%",
                            verticalAlign: "center"
                    },
                    toolTip: {
                            backgroundColor: "#ffffff",
                            borderThickness: 0,
                            cornerRadius: 0,
                            fontColor: "#424242"
                    },
                    data: [
                            {
                                    explodeOnClick: false,
                                    innerRadius: "76%",
                                    radius: "90%",
                                    startAngle: 270,
                                    type: "doughnut",
                                    dataPoints: {{TRS|raw}}
                            }
                    ]
                });
                
                salesDoughnutChartUS.render();
                    
             //Graphique sur la répartition des pcs svt programmes et machine
             var chart = new CanvasJS.Chart("chartContainer", {
                    animationEnabled: true,
                    exportEnabled: true,
                    title:{
                            text: ""
                    },
                    axisX: {
                            valueFormatString: "DDD",
                            labelFontSize: 24
                            //maximum: new date("14 Jul 2019")//{{FinSem|date('Y-m-d\\TH:i:sP')}}
                    },
                    axisY: {
                            prefix: ""
                    },
                    toolTip: {
                            shared: true
                    },
                    legend:{
                            cursor: "pointer",
                            itemclick: toggleDataSeries
                    },
                    data: {{Productivite|raw}}
            });
            chart.render();
            console.log(new Date(2017, 1, 3));

            function toggleDataSeries(e) {
                    if(typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                            e.dataSeries.visible = false;
                    }
                    else {
                            e.dataSeries.visible = true;
                    }
                    chart.render();
}
            //CanvasJS pie chart to show product wise annual revenue for 2015
            var productsRevenuePieChart = new CanvasJS.Chart("products-revenue-pie-chart", {
                animationEnabled: true,
                exportEnabled: true,
                theme: "theme2",
                legend: {
                    fontSize: 14
                },
                toolTip: {
                    borderThickness: 0,
                    content: "<span style='\"'color: {color};'\"'>{name}</span>: ${y} (#percent%)",
                    cornerRadius: 0
                },
                data: [
                    {       
                        type: "pie",
			indexLabel: "{name} ({y})",
                        indexLabelFontColor: "#676464",
                        indexLabelFontSize: 14,
                        percentFormatString: "#0.##",
                        toolTipContent: "{y} (#percent%)",
                        legendMarkerType: "square",
                        legendText: "{indexLabel}",
                        showInLegend: false,
                        startAngle:  90,
                        type: "pie",
                        dataPoints: {{RepartPolyms|raw}}
                    }
                ]
            });
            
            productsRevenuePieChart.render();
            
            //CanvasJS spline chart to show orders from Jan 2015 to Dec 2015
            var ordersSplineChart = new CanvasJS.Chart("orders-spline-chart", {
                animationEnabled: true,
                exportEnabled: true,
                theme: "theme2",
                toolTip: {
                    borderThickness: 0,
                    cornerRadius: 0
                },
                axisX: {
                    labelFontSize: 14,
                    maximum: new Date("31 Dec 2015"),
                    valueFormatString: "MMM YYYY"
                },
                axisY: {
                    gridThickness: 0,
                    labelFontSize: 14,
                    lineThickness: 2
                },
                data: [
                    {
                        type: "spline",
                        dataPoints: [
                            { x: new Date("1 Jan 2015"), y: 17376 },
                            { x: new Date("1 Feb 2015"), y: 21431 },
                            { x: new Date("1 Mar 2015"), y: 25724 },
                            { x: new Date("1 Apr 2015"), y: 22138 },
                            { x: new Date("1 May 2015"), y: 20676 },
                            { x: new Date("1 Jun 2015"), y: 25429 },
                            { x: new Date("1 Jul 2015"), y: 29160 },
                            { x: new Date("1 Aug 2015"), y: 23317 },
                            { x: new Date("1 Sep 2015"), y: 31883 },
                            { x: new Date("1 Oct 2015"), y: 30034 },
                            { x: new Date("1 Nov 2015"), y: 31768 },
                            { x: new Date("1 Dec 2015"), y: 41215 }
                        ]
                    }
                ]
            });

            ordersSplineChart.render();

            // CanvasJS bar chart secondery axis
            var chart = new CanvasJS.Chart("Rapport-Heures-pieces", {
                exportEnabled: true,
                animationEnabled: true,
                title:{
                    text: ""
                },
                subtitles: [{
                    text: ""
                }], 
                axisX: {
                    title: "Semaines"
                },
                axisY: {
                    title: "Pièces",
                    titleFontColor: "#4F81BC",
                    lineColor: "#4F81BC",
                    labelFontColor: "#4F81BC",
                    tickColor: "#4F81BC"
                },
                axisY2: {
                    title: "Heures",
                    titleFontColor: "#C0504E",
                    lineColor: "#C0504E",
                    labelFontColor: "#C0504E",
                    tickColor: "#C0504E"
                },
                toolTip: {
                    shared: true
                },
                legend: {
                    cursor: "pointer",
                    itemclick: toggleDataSeries
                },
                data: [{
                    type: "column",
                    name: "Heures Prod",
                    showInLegend: true,      
                    //yValueFormatString: "#,##0.# Units",
                    dataPoints: {{RapportH|raw}}
                },
                {
                    type: "column",
                    name: "Nbr Pcs",
                    axisYType: "secondary",
                    showInLegend: true,
                    yValueFormatString: "#,##0.# Pièces",
                    dataPoints: {{RapportPcs|raw}}
                }]
            });
            chart.render();
            
            // CanvasJS bar chart to show country wise annual users percentage
				var usersCountriesBarChart = new CanvasJS.Chart("users-countries-bar-chart", {
                    animationEnabled: true,
                    exportEnabled: true,
					theme: "theme2",
					axisX: {
						labelFontColor: "#848484",
						labelFontSize: 18,
						lineThickness: 0,
						tickThickness: 0
					},
					axisY: {
						gridThickness: 0,
						lineThickness: 0,
						tickThickness: 0,
						valueFormatString: " "
						                    
					},
					toolTip: {
						backgroundColor: "#ffffff",
						borderThickness: 0,
						cornerRadius: 0,
						fontColor: "#424242",
						contentFormatter: function (e) {
							return e.entries[0].dataPoint.label + ": " +  CanvasJS.formatNumber(Math.round(e.entries[0].dataPoint.y / 100 * totalUsers), '###,###'); // calculating and showing country wise number of users inside tooltip
						}
					},
					data: [
						{
							color: "#424242",
							indexLabelFontColor: "#848484",
							indexLabelFontFamily: "calibri",
							indexLabelFontSize: 18,
							indexLabelPlacement: "outside",
							type: "bar",
							dataPoints: {{ChargeMoy|raw}}
						}
					]
				});
            usersCountriesBarChart.render();
        });
</script>
{% endblock %}